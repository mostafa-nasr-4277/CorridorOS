<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Corridor Atlas — Offline Preview</title>
  <style>
    :root{--c:#00c8ff;--t:#00ffd5;--bg:#0b1020;--text:#e6fdff}
    html,body{height:100%;margin:0;background:radial-gradient(120% 120% at 50% 0%, #13283f 0%, #0e1a2b 48%, #0b1020 100%);color:var(--text);font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .bar{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));border:1px solid rgba(255,255,255,.14);border-radius:12px;padding:10px 12px}
    .title{display:flex;align-items:center;gap:10px;font-weight:800}
    .title img{height:22px;border-radius:6px}
    .grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:12px}
    .card{background:linear-gradient(180deg, rgba(0,200,255,.10), rgba(0,255,213,.08));border:1px solid rgba(0,200,255,.22);border-radius:12px;padding:12px}
    .gallery{display:grid;grid-template-columns:1fr;gap:10px}
    .gallery img{width:100%;height:180px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.14)}
    .btn{border:1px solid rgba(0,200,255,.4);background:transparent;border-radius:10px;padding:8px 12px;color:var(--text);cursor:pointer}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid rgba(0,200,255,.3);margin:0 6px 6px 0;font-size:12px}
    .imgs{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .imgs img{width:100%;height:140px;object-fit:cover;border-radius:10px;border:1px solid rgba(255,255,255,.14)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <div class="title"><img src="../vytall/assets/vytall_logo.png" alt="icon"/> Corridor Atlas — Offline Preview</div>
      <div>
        <button class="btn" onclick="window.top?.postMessage({type:'atlas-open-repo'},'*')">Open Repo</button>
      </div>
    </div>
    <div id="dyn"></div>
  </div>
  <script>
    async function load(){
      const root = document.getElementById('dyn');
      try{
        const res = await fetch('assets/atlas_manifest.json', {cache:'no-cache'});
        const j = await res.json();
        const byCat = {};
        for(const it of j.items){ (byCat[it.category] ||= []).push(it); }
        const cats = Object.keys(byCat);
        const frag = document.createDocumentFragment();
        // quick nav
        const nav = document.createElement('div');
        nav.style.margin = '10px 0';
        cats.forEach(c=>{ const a=document.createElement('a'); a.href='#'+c; a.className='pill'; a.textContent=c; nav.appendChild(a); });
        frag.appendChild(nav);
        // sections
        const grid=document.createElement('div'); grid.className='grid';
        cats.forEach(c=>{
          const card=document.createElement('div'); card.className='card'; card.id=c;
          const h=document.createElement('h3'); h.textContent=c; h.style.margin='0 0 8px 0'; card.appendChild(h);
          const imgs=document.createElement('div'); imgs.className='imgs';
          byCat[c].forEach(it=>{ const img=document.createElement('img'); img.loading='lazy'; img.src=it.file; img.alt=it.name; imgs.appendChild(img); });
          card.appendChild(imgs); grid.appendChild(card);
        });
        frag.appendChild(grid);
        root.replaceChildren(frag);
      }catch(e){
        root.textContent='Failed to load gallery manifest.';
      }
    }
    load();
  </script>
</body>
</html>
